description "akita/prometheus-exporter"

start on started and runlevel [2345]
stop on shutdown

respawn
respawn limit 5 15

setuid prometheus
setgid prometheus

script
exec /bin/bash << EOT
  export HOME=/opt/prometheus
  source /opt/prometheus/prometheus-exporter/.prometheus-exporter-rc
  
  if ! gem list prometheus_exporter -i; then
    cd $HOME && bundle install
  fi

  cd $HOME && prometheus_exporter -v -c prometheus-exporter/akita_collector.rb --prefix akita_
EOT
end script
